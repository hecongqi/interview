## **分布式数据库**

### **Redis**

#### **集群模式**

主从模式、哨兵模式、Cluster模式

主从模式：一个主节点负责写操作，一个或多个从节点负责读操作。主节点的数据自动同步到从节点，从节点不处理写操作。这种模式适用于数据备份和读写分离场景，配置简单，但主节点故障时需要手动切换。

哨兵模式：在主从复制的基础上增加了自动故障转移功能，哨兵节点负责监控主节点和从节点的状态，当主节点发生故障时，哨兵节点会自动将一个从节点提升为新的主节点，实心高可用。

Cluster模式：通过数据分片和负载均衡实现大规模数据存储和高性能。在Cluster模式下，数据分散在不同的节点上，每个节点都可以保存数据和整个集群状态，每个节点都合其他所有节点连接。Cluster模式采用无中心结构，适用于大规模数据存储和高性能场景。

#### **分布式锁**

用于解决分布式环境下多个进程或多个服务对共享资源的并发操作，避免冲突

**Redis分布式锁的实现原理**

1 获取锁

SET key value NX PX expiration_time

key是锁的唯一标识。

value是锁的值，用来确保不会被错误释放。

NX确保key仅在不存在时才会被设置

PX expiration_time设置锁的过期时间，防止进程异常退出，锁永远不被释放

2 释放锁

if redis.get(key) == value:

  redis.del(key)

通过校验value的方式，可以确保锁不会被其他客户端错误释放

**存在的问题**

锁的失效问题，任务的执行时间超过了锁的过期时间，可以通过锁续期来延长锁的有效时间

**分布式锁的使用场景**

分布式任务调度

**解决方案**

Redisson

#### **集群**

键->哈希槽->节点

哈希槽只分配给主节点，主节点出现故障以后，从节点会代替失效的主节点，集群内更新哈希槽与节点的映射信息

#### **数据库****一致性**

无法完全保证一致，仅提供最终一致性

1 缓存数据设置过期时间，可以降低不一致性，即使应用系统挂掉，缓存也会自动失效

2 分布式场景下，使用分布式锁保证一次只有一个线程更新缓存和数据库

#### **缓存穿透击穿雪崩**

穿透是请求的数据在缓存和数据库都不存在

击穿是热点数据缓存过期，导致大量请求访问数据库，可使用分布式锁来确保只有一个请求查库并写缓存，可以采用异步方式提高性能

雪崩指在某时间点，大量缓存同时失效，导致大量请求访问数据库，可设置不同过期时间解决

### **ES**

#### **倒排索引**

正排索引是文档和词项的映射关系，倒排索引是词项到文档的映射关系。

在正排索引中，查找一个词项时，需要遍历所有的文档。

倒排索引可以快速找到某个词项出现在哪些文档中

 

l OceanBase

l Doris

l TIDB

 

### **MongoDB**

以JSON格式存储数据，支持嵌套结构，代替关系数据库的关联操作

 